<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Escala de Café</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <style>
      :root {
        --accent-color: #e74c3c;
        --white: #fff;
      }
      #personList {
        list-style-type: none;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
        padding: 0;
      }
      /* Centralização e estética dos controles de mês/ano/checkbox */
      .center-controls .form-label {
        font-weight: 600;
      }
      .center-controls .form-select {
        text-align: center;
        text-align-last: center; /* centra o texto do option selecionado no Chrome/Edge */
      }
      .center-controls .col-md-3,
      .center-controls .col-md-6 {
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      /* Destaque visual do switch de ordem alfabética contínua */
      .alpha-toggle {
        border: 1px solid #dee2e6;
        border-radius: 12px;
        background: #f8f9fa;
        transition: box-shadow .2s ease, background .2s ease;
      }
      .alpha-toggle:hover {
        background: #f1f3f5;
        box-shadow: 0 4px 10px rgba(0,0,0,.06);
      }
      .alpha-toggle .form-check-input {
        width: 2.4rem;
        height: 1.2rem;
        cursor: pointer;
      }
      .alpha-toggle .form-check-input:checked {
        background-color: #198754;
        border-color: #198754;
      }
      .alpha-toggle .form-check-label {
        cursor: pointer;
        user-select: none;
        color: #212529;
      }
      #personList li {
        background-color: var(--white);
        padding: 10px 15px;
        border-radius: 5px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .remove-button {
        background: none;
        border: none;
        cursor: pointer;
        font-size: 1.2em;
        color: var(--accent-color);
        padding: 0;
      }
      .remove-button:hover {
        color: #c0392b;
      }
      /* Layout consistente do calendário na tela e no PDF */
      #calendar {
        max-width: 100%;
      }
      /* Ao exportar, fixa a largura equivalente a A4 em ~96dpi */
      .exporting-pdf #calendar {
        /* Mantém layout sem forçar largura fixa para evitar cortes */
        width: auto;
        margin-left: auto;
        margin-right: auto;
      }
      .calendar-table {
        table-layout: fixed;
        width: 100%;
        border-collapse: collapse;
        border: 1px solid #dee2e6;
      }
      .calendar-table th,
      .calendar-table td {
        width: 14.2857142857%;
        box-sizing: border-box;
        vertical-align: top;
        border: 1px solid #dee2e6;
        /* evita quebras no meio da célula ao paginar */
        page-break-inside: avoid;
        break-inside: avoid;
      }
      .calendar-table tr {
        page-break-inside: avoid;
        break-inside: avoid;
      }
      .calendar-table td {
        height: 120px; /* mantém altura uniforme por dia */
        min-height: 120px; /* garante espaço mínimo para textos longos */
      }
      .calendar-table .d-flex {
        height: 100%;
        align-items: flex-start;
      }
      /* Evita que textos longos quebrem o layout dos dias */
      .calendar-table .morning-person,
      .calendar-table .afternoon-person {
        word-break: break-word;
        overflow-wrap: anywhere;
        text-align: center;
      }
      /* Garante que o nome do feriado não fique cortado */
      .calendar-table .holiday {
        display: block;
        max-width: 100%;
        padding: 8px 6px;
        margin-top: 8px;
        line-height: 1.3;
        white-space: normal;
        word-break: break-word;
        overflow-wrap: anywhere;
        box-sizing: border-box;
        min-height: 40px;
        text-align: center;
        font-size: 12px;
        font-weight: normal;
      }
      /* Regras específicas para exportação PDF */
      .exporting-pdf .calendar-table .holiday {
        display: block !important;
        padding: 6px 4px !important;
        margin-top: 6px !important;
        line-height: 1.2 !important;
        white-space: normal !important;
        word-break: break-word !important;
        overflow-wrap: anywhere !important;
        text-align: center !important;
        font-size: 11px !important;
        min-height: 36px !important;
        max-height: 50px !important;
        overflow: visible !important;
      }
      /* Suaviza fontes durante exportação para evitar serrilhado */
      .exporting-pdf * {
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
      /* Oculta o botão editar durante exportação controlada por classe */
      .exporting-pdf .edit-button-class {
        display: none !important;
      }
      @media print {
        .edit-button-class {
          display: none !important;
        }
      }
      #pdf-watermark-container {
        display: none;
        text-align: center;
        margin-top: 20px;
        font-size: 14px;
        color: #292929;
      }
      .exporting-pdf #pdf-watermark-container {
        display: block;
      }
      .exporting-pdf #page-footer {
        display: none;
      }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center mb-4">Escala de Café</h1>

        <div class="row justify-content-center mb-4">
            <div class="col-md-6">
                <form id="personForm" class="input-group">
                    <input type="text" id="personName" class="form-control" placeholder="Nome da pessoa" required>
                    <button type="submit" class="btn btn-primary">Adicionar Pessoa</button>
                </form>
            </div>
        </div>

        <h2 class="text-center mb-3">Pessoas Adicionadas:</h2>
        <ul id="personList" class="mb-4"></ul>

        <div class="row justify-content-center align-items-end mb-4 g-3 center-controls">
            <div class="col-md-3">
                <label for="month" class="form-label text-center w-100">Mês:</label>
                <select id="month" name="month" class="form-select">
                    <option value="0">Janeiro</option>
                    <option value="1">Fevereiro</option>
                    <option value="2">Março</option>
                    <option value="3">Abril</option>
                    <option value="4">Maio</option>
                    <option value="5">Junho</option>
                    <option value="6">Julho</option>
                    <option value="7">Agosto</option>
                    <option value="8">Setembro</option>
                    <option value="9">Outubro</option>
                    <option value="10">Novembro</option>
                    <option value="11">Dezembro</option>
                </select>
            </div>
            <div class="col-md-3">
                <label for="year" class="form-label text-center w-100">Ano:</label>
                <select id="year" name="year" class="form-select"></select>
            </div>
            <div class="col-md-6">
                <div class="form-check form-switch alpha-toggle mt-4 d-flex justify-content-center align-items-center p-3">
                    <input class="form-check-input" type="checkbox" value="1" id="alphaContinuous">
                    <label class="form-check-label ms-3 fw-semibold" for="alphaContinuous">
                        Escala em ordem alfabética contínua
                    </label>
                </div>
            </div>
        </div>

        <div class="d-grid gap-2 col-6 mx-auto mb-4">
            <button onclick="generateSchedule()" class="btn btn-success">Criar Escala</button>
            <button onclick="exportToPDF()" class="btn btn-secondary">Exportar para PDF</button>
        </div>

        <div id="messages" class="mb-3"></div>

        <div id="calendar"></div>
        <div id="pdf-watermark-container">
          Feito por Caio Victor ©<br>
          <span class="pdf-only">Visite meu site em: escaladocafe.netlify.app</span>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
    <script src="script.js"></script>

    <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="editModalLabel">Editar Dia</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <input type="hidden" id="editDayInput">
            <div class="mb-3">
              <label for="morningPersonInput" class="form-label">Manhã</label>
              <input type="text" class="form-control" id="morningPersonInput">
            </div>
            <div class="mb-3">
              <label for="afternoonPersonInput" class="form-label">Tarde</label>
              <input type="text" class="form-control" id="afternoonPersonInput">
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
            <button type="button" class="btn btn-primary" onclick="saveChanges()">Salvar</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="infoModal" tabindex="-1" aria-labelledby="infoModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg">
          <div class="modal-header bg-primary text-white">
            <h5 class="modal-title" id="infoModalLabel">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-info-circle-fill me-2" viewBox="0 0 16 16">
                <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/>
              </svg>
              Como Funciona a Escala Ordem Alfabética Contínua?
            </h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body p-4">
            <p>Esta opção cria uma escala mais justa e rotativa ao longo dos meses. Veja como funciona:</p>
            <ul class="list-group list-group-flush">
              <li class="list-group-item d-flex align-items-start">
                <span class="badge bg-primary rounded-pill me-3 mt-1">1</span>
                <div>
                  <strong>Ordem Alfabética</strong><br>
                  A lista de pessoas é sempre organizada em ordem alfabética para a distribuição.
                </div>
              </li>
              <li class="list-group-item d-flex align-items-start">
                <span class="badge bg-primary rounded-pill me-3 mt-1">2</span>
                <div>
                  <strong>Continuidade Inteligente</strong><br>
                  O sistema memoriza a <strong>última pessoa</strong> que foi escalada no mês anterior.
                </div>
              </li>
              <li class="list-group-item d-flex align-items-start">
                <span class="badge bg-primary rounded-pill me-3 mt-1">3</span>
                <div>
                  <strong>Rotação Justa</strong><br>
                  A escala do novo mês começará com a <strong>próxima pessoa</strong> da lista, garantindo que o primeiro da escala seja sempre alguém diferente.
                </div>
              </li>
            </ul>
            <div class="alert alert-info mt-3" role="alert">
              <strong>Exemplo:</strong> Se a escala de Janeiro terminou com "Bruno", a de Fevereiro começará com "Carla" (a próxima na ordem alfabética).
            </div>
          </div>
        </div>
      </div>
    </div>

    <footer id="page-footer" class="text-center mt-4 mb-4">Feito por Caio Victor</footer>
</body>
</html>